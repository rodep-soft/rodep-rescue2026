services:
  ros2_container:
    # Instead of 'image', use 'build' to build from your Dockerfile
    build:
      context: . # Looks for Dockerfile in the current directory
      dockerfile: Dockerfile

    container_name: ros2_working_container
    tty: true
    privileged: true
    network_mode: host
    # Update working_dir to match the user's home in Dockerfile
    working_dir: /root/

    environment:
      - ROS_DOMAIN_ID=0
      - DEBIAN_FRONTEND=noninteractive
      - DISPLAY=${DISPLAY}   # <-- CRUCIAL: Passes the host's display variab
    volumes:
      # Mount host ~/.ssh to the new user's home in container
      - ~/.ssh:/root/.ssh:ro # <--- REPLACE with your actual host username
      # Mount your ROS workspace
      - ./:/root/ # <--- REPLACE with your actual host username
      - ~/.ccache:/root/.ccache
      - /tmp/.X11-unix:/tmp/.X11-unix:rw # <-- Shares the X server socket
