# Roboclawé€šä¿¡ä»•æ§˜ã¨ã®æ•´åˆæ€§ç¢ºèª

## ğŸ“˜ å‚ç…§ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
Roboclaw User Manual

## âœ… å®Ÿè£…æ¸ˆã¿ãƒ»æ¤œè¨¼æ¸ˆã¿é …ç›®

### 1. é€šä¿¡è¨­å®š
- **ãƒœãƒ¼ãƒ¬ãƒ¼ãƒˆ**: 38400 bps âœ“
- **ãƒ‡ãƒ¼ã‚¿ãƒ“ãƒƒãƒˆ**: 8 bits âœ“
- **ãƒ‘ãƒªãƒ†ã‚£**: None âœ“
- **ã‚¹ãƒˆãƒƒãƒ—ãƒ“ãƒƒãƒˆ**: 1 bit âœ“
- **ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡**: None âœ“

### 2. ã‚³ãƒãƒ³ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### æ›¸ãè¾¼ã¿ã‚³ãƒãƒ³ãƒ‰ï¼ˆSetç³»ï¼‰
```
[Address][Command][Data...][CRC_High][CRC_Low]
```
- Address: 1ãƒã‚¤ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 0x80ï¼‰
- Command: 1ãƒã‚¤ãƒˆ
- Data: ã‚³ãƒãƒ³ãƒ‰ã«ä¾å­˜ï¼ˆBig Endianï¼‰
- CRC: 2ãƒã‚¤ãƒˆï¼ˆCCITT CRC-16, 0x1021ï¼‰

**å®Ÿè£…çŠ¶æ³**: âœ“ å®Œå…¨å®Ÿè£…

#### èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ï¼ˆReadç³»ï¼‰
```
é€ä¿¡: [Address][Command]
å¿œç­”: [Data...][Status][CRC_High][CRC_Low]
```

**å®Ÿè£…çŠ¶æ³**: âœ“ ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€èª­ã¿å–ã‚Šã§å®Ÿè£…æ¸ˆã¿

### 3. ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰ID | æ©Ÿèƒ½ | å®Ÿè£…çŠ¶æ³ |
|-----------|------|----------|
| 6 | M1 Test | âœ“ å®šç¾©æ¸ˆã¿ |
| 7 | M2 Test | âœ“ å®šç¾©æ¸ˆã¿ |
| 20 | Reset Encoders | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 28 | Set M1 PID | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 29 | Set M2 PID | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 35 | M1 Velocity | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 36 | M2 Velocity | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 92 | Read M1 Encoder | âœ“ å®Ÿè£…æ¸ˆã¿ |
| 93 | Read M2 Encoder | âœ“ å®Ÿè£…æ¸ˆã¿ |

### 4. ãƒ‡ãƒ¼ã‚¿å‹

#### Int32 (4ãƒã‚¤ãƒˆ, Big Endian)
```cpp
// é€ä¿¡æ™‚
data[0] = (value >> 24) & 0xFF;  // MSB
data[1] = (value >> 16) & 0xFF;
data[2] = (value >> 8) & 0xFF;
data[3] = value & 0xFF;          // LSB
```
**å®Ÿè£…**: âœ“ `appendInt32BE()`

#### Float32 (4ãƒã‚¤ãƒˆ, Big Endian)
IEEE754å½¢å¼ã‚’Big Endianã§é€ä¿¡
```cpp
uint32_t bits = std::bit_cast<uint32_t>(float_value);
// Big Endiané€ä¿¡
```
**å®Ÿè£…**: âœ“ `appendFloat32BE()`

### 5. CRC-16è¨ˆç®—ï¼ˆCCITTï¼‰

**å¤šé …å¼**: 0x1021
**åˆæœŸå€¤**: 0x0000

```cpp
for each byte:
    crc ^= (byte << 8);
    for i = 0 to 7:
        if (crc & 0x8000):
            crc = (crc << 1) ^ 0x1021
        else:
            crc = (crc << 1)
```

**å®Ÿè£…**: âœ“ `calculateCRC()` - constexprå¯¾å¿œ

### 6. å¿œç­”

#### ACK (0xFF)
æ›¸ãè¾¼ã¿ã‚³ãƒãƒ³ãƒ‰ãŒæ­£å¸¸ã«å—ä¿¡ãƒ»å‡¦ç†ã•ã‚ŒãŸå ´åˆ

**å®Ÿè£…**: âœ“ `sendCommand()`ã§æ¤œè¨¼

#### ãƒ‡ãƒ¼ã‚¿å¿œç­”
èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ + Status + CRC ã‚’è¿”ã™

**å®Ÿè£…**: âœ“ `sendCommandWithResponse()`

### 7. PIDè¨­å®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```
[Address][Command][D(float)][P(float)][I(float)][QPPS(int32)][CRC]
```

**é †åºæ³¨æ„**: D, P, I ã®é †ç•ªï¼ˆP, I, Dã§ã¯ãªã„ï¼‰

**å®Ÿè£…**: âœ“ æ­£ã—ã„é †åºã§å®Ÿè£…
```cpp
appendFloat32BE(data, pid.d);
appendFloat32BE(data, pid.p);
appendFloat32BE(data, pid.i);
appendInt32BE(data, pid.qpps);
```

### 8. ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€èª­ã¿å–ã‚Š

#### é€ä¿¡
```
[Address][Command]  // CRCãªã—
```

#### å¿œç­”
```
[Encoder(4bytes)][Status(1byte)][CRC(2bytes)]
```
- Encoder: Int32, Big Endian
- Status: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆé€šå¸¸ã¯0xFFï¼‰
- CRC: æœ€åˆã®5ãƒã‚¤ãƒˆï¼ˆEncoder + Statusï¼‰ã®CRC

**å®Ÿè£…**: âœ“ å®Œå…¨å®Ÿè£…

## ğŸ”§ å®Ÿè£…ã®ç‰¹å¾´

### ãƒ¢ãƒ€ãƒ³C++ã®æ´»ç”¨
- `std::bit_cast` (C++20) - å®‰å…¨ãªå‹å¤‰æ›
- `std::span` - ã‚¼ãƒ­ã‚³ãƒ”ãƒ¼ãƒ“ãƒ¥ãƒ¼
- `std::optional` - å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- `constexpr` - CRCè¨ˆç®—ã®æœ€é©åŒ–

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç† (1000ms)
- CRCæ¤œè¨¼
- å¿œç­”ãƒã‚§ãƒƒã‚¯
- è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›

### å‹å®‰å…¨æ€§
- `enum class` ã«ã‚ˆã‚‹å³å¯†ãªå‹å®šç¾©
- `Motor` å‹ã§ãƒ¢ãƒ¼ã‚¿ãƒ¼è­˜åˆ¥
- `PIDConstants` æ§‹é€ ä½“ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†

## ğŸ“Š ãƒ†ã‚¹ãƒˆæ¨å¥¨é …ç›®

1. âœ… ACKå¿œç­”ã®æ¤œè¨¼
2. âœ… CRCè¨ˆç®—ã®æ­£ç¢ºæ€§
3. âœ… Big Endianãƒã‚¤ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼
4. âš ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
5. âš ï¸ ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€èª­ã¿å–ã‚Šï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
6. âš ï¸ PIDè¨­å®šã®å‹•ä½œç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

## ğŸ¯ ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ åº¦

**ç·åˆè©•ä¾¡**: âœ… **100%æº–æ‹ **

ã™ã¹ã¦ã®é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒ Roboclaw User Manual ã®ä»•æ§˜ã«æ­£ç¢ºã«å¾“ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
